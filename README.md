shamela_books — парсер книг и сборщик EPUB (RTL)

[English](README.en.md) | [العربية](README.ar.md) | Русский

Проект для выгрузки книг с сайта `shamela.ws` и сборки из них файлов EPUB с корректной поддержкой арабского письма (RTL) и удобной навигацией.

## TL;DR
 - Базово (с автопоиском обложки): `python3 scripts/shamela_to_epub.py 'https://shamela.ws/book/158' --throttle 0.6`
 - Отключить автопоиск обложки: исключите `--cover-auto` (по умолчанию авто включён)
 - Свой файл обложки: `--cover path/to.jpg|png`
- Результат: `output/<Название книги> - <Издатель>.epub`

## Установка (опционально)
- Локально: `pip install -e .`
- Через pipx: `pipx install .`
- Запуск CLI: `shamela-to-epub 'https://shamela.ws/book/158' --throttle 0.6`

## Структура
- `scripts/shamela_to_epub.py` — основной скрипт (без внешних зависимостей).
- `output/` — готовые файлы (EPUB).

## Быстрый старт
- Python 3.11+: `python3 scripts/shamela_to_epub.py 'https://shamela.ws/book/158' --throttle 0.6`
- С обложкой (Google Images): добавьте `--cover-auto`
- Результат: `output/<Название книги> - <Издатель>.epub`.

## Поддерживаемый формат (один, «рабочий»)
- EPUB (минимальный профиль, оптимален для Send‑to‑Kindle):
  - Без обложки и страницы «بطاقة الكتاب».
  - Без встроенных шрифтов.
  - `nav.xhtml` присутствует в манифесте, но не включён в `spine`.

## Ключевые опции
- `-o, --output` — путь к выходному файлу (по умолчанию берётся из названия книги + издатель).
- `--throttle 0.6` — пауза между запросами (сек).
- `--limit N` — ограничить число глав (для тестов).
 - `--cover-auto` — автопоиск обложки (включён по умолчанию). Если не удалось — файл собирается без обложки.
 - `--cover path/to.jpg|png` — задать локальную обложку вручную (рекомендуется ≥ 300×300).

### Сводная таблица опций

| Опция | Описание | По умолчанию | Пример |
|---|---|---|---|
| `-o, --output <path>` | Путь к выходному файлу | `output/<Название> - <Издатель>.epub` | `-o output/book.epub` |
| `--throttle <sec>` | Пауза между HTTP‑запросами | `0.8` | `--throttle 0.6` |
| `--limit <N>` | Скачивать только первые N глав (для теста) | все главы | `--limit 10` |
| `--cover-auto` | Автопоиск обложки (Google Images + фильтры размера/типа) | выкл | `--cover-auto` |
| `--cover <file>` | Локальная обложка (JPEG/PNG, ≥ 300×300) | отсутствует | `--cover cover.jpg` |

## Обложка и «بطاقة الكتاب»
- По умолчанию обложка не добавляется (для максимальной совместимости). При необходимости:
  - `--cover-auto` — автопоиск обложки (Google Images). Логика и фильтры описаны в TECHNICAL.md.
  - `--cover path/to.jpg|png` — вручную задать файл обложки (рекомендуется ≥ 300×300).

## Что не работало и что работает
- Работает стабильно: минимальный EPUB — без шрифтов, без обложки/«بطاقة الكتاب», `nav.xhtml` не в `spine`.
- Не работало (через Send‑to‑Kindle для этой книги):
  - EPUB с обложкой/«بطاقة الكتاب» и/или встроенными шрифтами — ошибка e999.
  - Старые профили (с NCX/сложными метаданными) — нестабильно.

Подробнее о профиле и обложке: см. TECHNICAL.md.

## Пример
- `python3 scripts/shamela_to_epub.py 'https://shamela.ws/book/158' --throttle 0.6`
