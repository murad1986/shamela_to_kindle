shamela_books — تحويل كتب الشاملة إلى EPUB (اتجاه RTL)

أداة خفيفة لبناء ملفات EPUB متوافقة مع Kindle من موقع `shamela.ws`، مع الحفاظ على النص العربي واتجاه القراءة من اليمين إلى اليسار وبنية بسيطة.

## خلاصة سريعة (TL;DR)
- الأساس: `python3 scripts/shamela_to_epub.py 'https://shamela.ws/book/158' --throttle 0.6`
- مع غلاف: أضف `--cover-auto` (أو `--cover path/to.jpg|png`)
- الناتج: `output/<العنوان> - <الناشر>.epub`

## بنية المستودع
- `scripts/shamela_to_epub.py`: السكربت الرئيسي (بدون اعتماديات خارجية).
- `output/`: المخرجات (غير متتبَّعة في git).

## التنسيق المدعوم (واحد فقط)
- EPUB بملف تعريف «مصغَّر»:
  - بدون خطوط مضمّنة.
  - بدون صفحة غلاف أو «بطاقة الكتاب» داخل الملف.
  - ملف `nav.xhtml` موجود في manifest لكنه غير مضاف إلى spine.
  - فصول XHTML نظيفة مع CSS خارجي واتجاه RTL.

## طريقة الاستخدام
- تنزيل كتاب كامل: `python3 scripts/shamela_to_epub.py 'https://shamela.ws/book/158' --throttle 0.6`
- مع غلاف (بحث Google Images): أضف `--cover-auto`
- تجربة سريعة (أول N فصل): `--limit N`
- اسم الملف الناتج: `<العنوان> - <الناشر>.epub`
  - نحافظ على الحروف العربية والمسافات (بدون شرطات سفلية).
  - نحذف بادئة «كتاب/الكتاب» من العنوان.

## الخيارات
- `-o, --output`: مسار الملف الناتج.
- `--throttle <ثوانٍ>`: مهلة بين الطلبات (الافتراضي 0.8). استخدم 0.6–1.0 للحفاظ على الخادم.
- `--limit <N>`: جلب أول N فصل (للاختبار).
- `--cover-auto`: محاولة جلب أول نتيجة من Google Images كغلاف؛ في حال الفشل يُبنى الملف بدون غلاف.
- `--cover path/to.jpg|png`: تحديد غلاف محلي يدويًا (مستحسن ≥ 300×300).

### ملخص الخيارات

| الخيار | الوصف | الافتراضي | المثال |
|---|---|---|---|
| `-o, --output <path>` | مسار ملف الإخراج | `output/<العنوان> - <الناشر>.epub` | `-o output/book.epub` |
| `--throttle <sec>` | مهلة بين طلبات HTTP | `0.8` | `--throttle 0.6` |
| `--limit <N>` | جلب أول N فصل (اختبار سريع) | كل الفصول | `--limit 10` |
| `--cover-auto` | بحث تلقائي عن غلاف (Google Images + مرشّحات الحجم/النوع) | معطّل | `--cover-auto` |
| `--cover <file>` | غلاف محلي (JPEG/PNG، ≥ 300×300) | لا يوجد | `--cover cover.jpg` |

## ما يعمل وما لا يعمل
- يعمل بثبات: EPUB «المصغَّر» أعلاه — يمر عبر Send‑to‑Kindle لهذا الكتاب.
- غير موثوق عبر Send‑to‑Kindle (تم استبعاده):
  - EPUB مع خطوط مضمّنة أو صفحات إضافية (غلاف/بطاقة) — غالبًا خطأ e999.
  - ملفات قديمة (NCX/بيانات وصفية معقدة) — غير ثابتة.

تفاصيل أكثر حول الملف والغلاف: راجع TECHNICAL.md.

## ملاحظات
- احترم الموقع: لا توازِ الطلبات واستخدم مهلة مناسبة.
- عرض RTL يعتمد على القارئ المستخدم.
- إن رُفض الملف من Kindle، جرّب النسخ المباشر عبر USB (بدون تحويل).
